#! /bin/sh

set -x

if command -v xscreensaver-command 1>/dev/null 2>/dev/null
then
    if ! xscreensaver-command -lock
    then
        xscreensaver &
        sleep 10
        xscreensaver-command -lock
    fi

    MYPID="$$"

    xscreensaver-command -watch | while IFS= read LINE
    do
        SHOULD_EXIT=0
        case "$LINE" in
            UNBLANK*)
                my-kill-my-screensaver
                kill "$MYPID"
            ;;
        esac
    done
else
    if command -v slock 1>/dev/null 2>/dev/null
    then slock || slimlock
    else
        if command -v slimlock 1>/dev/null 2>/dev/null
        then slimlock
        else
            echo "Neither slimlock, slock nor xscreensaver-command present! Cannot lock the screen." 1>&2
            notify-send --urgency=critical "Neither slimlock, slock nor xscreensaver-command present! Cannot lock the screen."
        fi
    fi
fi

# slock || slimlock

# gnome-screensaver &
# gnome-screensaver-command --lock
